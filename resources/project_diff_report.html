<html lang="en">
<head>
    <title>{{title}}</title>

    <link rel="stylesheet" type="text/css" href="css/datatables.min.css"/>

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/datatables.min.js"></script>
    <!-- This is generated -->
    <script type="text/javascript" src="project_data.js"></script>

    <link rel="stylesheet" href="css/maven-base.css">
    <link rel="stylesheet" href="css/maven-theme.css">
</head>
<body>

<div class="section">

    <h2>Violations</h2>

    <table id="violationsTable" width="100%">
        <thead>
        <tr>
            <th>Location</th>
            <th>Rule</th>
            <th>Message</th>
        </tr>
        </thead>
    </table>


</div>

<script type="text/javascript">

    function makeCodeLink(violation) {
        let template = project.source_link_template
        template = template.replace('{file}', violation.file)
        return template.replace('{line}', violation.line)
    }

    function extractFilename(path) {
        const pathArray = path.split("/");
        return pathArray[pathArray.length - 1];
    }

    const cssClass = {
        "+": "added",
        "-": "removed",
        "~": "changed",
    }

    $(document).ready(function () {
        $('#violationsTable').DataTable({
            data: project.violations,
            columns: [
                {"data": "file"},
                {"data": "rule"},
                {"data": "message"},
            ],
            columnDefs: [
                {
                    render(data, type, row) {
                        // display only the file name (not full path), but use full
                        // path for sorting and such
                        return type === "display"
                            ? "<a href='" + makeCodeLink(row) + "'>" + extractFilename(data) + " @ line " + row.line + "</a>"
                            : data;
                    },
                    targets: 0
                }
            ],
            displayLength: 50,
            rowCallback(row, data, index) {
                $(row).addClass(cssClass[data.t]);
            },
        });
    });
</script>

</body>
</html>
